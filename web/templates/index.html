{% extends 'base.html' %}
{% block content %}
  <section class="hero card">
    <h1>Подготовка к олимпиадам и тестам</h1>
    <p class="muted">Единая платформа KSIGMA: решай задания, отслеживай прогресс и качай темы системно.</p>
  </section>

  {% if user %}
    <section class="card">
      <p>Вы вошли как <strong>{{ user.full_name }}</strong> (роль: {{ user.role }}).</p>
      <div class="actions">
        <a class="btn" href="/solve">Начать решать</a>
        <a class="btn btn-soft" href="/stats">Моя статистика</a>
        {% if user.role in ['admin', 'superadmin'] %}
          <a class="btn btn-soft" href="/admin/import">Bulk-импорт вопросов</a>
        {% endif %}
      </div>
    </section>
  {% else %}
    <p class="muted">Вход через код из Telegram-бота.</p>

    {% if error %}
      <p class="status status-bad"><strong>{{ error }}</strong></p>
    {% endif %}

    {% if info %}
      <p class="status status-ok"><strong>{{ info }}</strong></p>
    {% endif %}

    <div class="card">
      <h3>1. Укажите Telegram</h3>
      <p class="muted">Введите <code>@username</code> или numeric <code>tg_id</code> и нажмите «Отправить код».</p>
      <form action="/auth/request-code" method="post">
        <input type="text" name="telegram" placeholder="@username или 123456789" required />
        <button class="btn" type="submit">Отправить код</button>
      </form>
    </div>

    <div class="card">
      <h3>2. Введите код</h3>
      {% if pending_login %}
        <p class="muted">Код отправлен для аккаунта {{ pending_login_name or pending_tg_id }}.</p>
      {% else %}
        <p class="muted">Сначала запросите код на шаге 1.</p>
      {% endif %}
      <form action="/auth/verify-code" method="post">
        <input type="text" name="code" pattern="[0-9]{6}" maxlength="6" placeholder="123456" required />
        <button class="btn" type="submit">Войти</button>
      </form>
    </div>
  {% endif %}
{% endblock %}
